# The Adobe Privacy JavaScript Library and GDPR

Information about how Adobe works with you to comply with the European Union's General Data Protection Regulation (GDPR).

On May 25, 2018, the European Union's GDPR goes into effect. For more information about what this means for you, see [GDPR and Your Business](https://www.adobe.com/privacy/general-data-protection-regulation.html).

When Adobe is providing software and services to an enterprise, Adobe is acting as a data processor for any personal data it processes and stores as part of providing these services. As a data processor, Adobe processes personal data in accordance with your company's permission and instructions (for example, as set out in your agreement with Adobe).

As the data controller, you determine the personal data that Adobe processes and stores on your behalf. If you use Adobe Experience Cloud solutions, Adobe might host personal data for you, depending on the solutions you use and the information you choose to send to your Adobe Experience Cloud account. For a detailed list of examples, see [Adobe Experience Cloud Privacy](https://www.adobe.com/privacy/marketing-cloud.html).

## Adobe JavaScript APIs

Adobe Experience Cloud provides GDPR-ready JavaScript APIs for data controllers. The Adobe Privacy JavaScript library is used to retrieve all the IDs generated by the Adobe Experience Cloud libraries for a specific domain.

The Adobe Privacy JavaScript library follows a Plugin architecture where one core object is presented to the customer and that object's API delegates the actual work to plugins. Those plugins are implemented by the individual Adobe solution teams.

The signatures for the functions presented by the Adobe Privacy JavaScript library are as follows:

* `retrieveIdentities`

    function: `callback(array: validIDs, array: failedIDs)`

* `removeIdentities`

    function: `callback(array: validIDs, array: failedIDs)``

    The `hasBeenDeleted` field for each entry in the `validIDs` array will be marked as true or false, depending on whether this ID has been deleted.

**Note:**

* AdobePrivacy.js does not submit information to the Experience Cloud Central Service. The customer must do that. This library only provides the IDs that are stored in the browser a that specific visitor.
* `removeIdentities` only removes identities from the browser for specific Adobe solutions that support it. For example, AAM does not delete the demdex ID that is stored in a 3rd party cookie, but Target deletes the cookies storing their IDs.

## Installation

There are multiple installation options for the JavaScript APIs:

* Download the JavaScript Library manually from here: [https://assets.adobedtm.com/experience-cloud/privacy/js/adobeprivacy.bundle.js](https://assets.adobedtm.com/experience-cloud/privacy/js/adobeprivacy.bundle.js)

* Include a reference to the script directly on their site by adding the following inside the `<head>` element of your web page(s):

    ```javascript
    <script type="text/javascript" src="//assets.adobedtm.com/experience-cloud/privacy/js/adobeprivacy.bundle.js"></script>
    ```

* Install the script via DTM by adding a "Sequential JavaScript Tag"
* Use the pre-built Launch Extension in Adobe's New Tag Management Offering, ["Launch, by Adobe"](https://www.adobe.com/enterprise/cloud-platform/launch.html)

* Reference the NPM library during your own build process

## Instantiate the AdobePrivacy.js library

```
var adobePrivacy = new AdobePrivacy({ENTER YOUR ADOBE SOLUTIONS SPECIFIC CONFIGURATION HERE});
```

## Supported configurations

### Adobe Analytics

*   **cookieDomainPeriods**: Specifies the number periods in a domain for cookie tracking (default 2, e.g. domain.com)
*   **dataCenter**: Adobe data collection data center. d1 = San Jose data center, d2 = Dallas data center. Do not define it here unless specified in your JavaScript Web beacon
*   **reportSuite**: Report Suite ID as specified in your JavaScript Web beacon (e.g. s_code.js, dtm, etc)
*   **trackingServer**: Data collection domain (non-ssl). Do not define it here unless specified in your JavaScript Web beacon
*   **trackingServerSecure**: Data collection domain (ssl). Do not define it here unless specified in your JavaScript Web beacon
*   **visitorNamespace**: Namespace used to group visitors. Do not define it here unless specified in your JavaScript Web beacon.

### Adobe Target

**clientCode**: Client Code that identifies a client in Target System.

### Audience Manager

**aamUUIDCookieName**: Name of first party cookie with the unique user ID returned from Audience Manager

### ID Service (ECID)

**imsOrgID**: Your Organization ID in Adobe

## Code samples

The following code samples show the code to use for common scenarios, if you're not using Launch or DTM.

1. Instantiate AdobePrivacy:

    ```
    var adobePrivacy = new AdobePrivacy({
        imsOrgID: “YOUR_ORG_ID@AdobeOrg",
        reportSuite: "Report-Suite-ID",
        trackingServer: "metrics.mycompany.com",
        clientCode: “TARGET_CLIENT_CODE"
    });
    ```

2. Retrieve Identities by calling this asynchronous API:

    ```javascript
    <script type="text/javascript" src="adobeprivacy.js"></script>

    <script>
        visitor.getMarketingCloudVisitorID(function() {
            var adobePrivacy = new AdobePrivacy({
                imsOrgID: "abcde12345fghij67890",
                Campaign: "123456"
            });

            function callback(validIds, invalidIds) {
                console.log("Valid IDs retrieved:");

                validIds.users[0].userIDs.forEach(function (id) {
                    console.log(id.namespace + ": " + (id.value ? id.value : id));
                });

                if (invalidIds) {
                    console.log("Invalid IDs retrieved:");

                    invalidIds.users[0].userIDs.forEach(function (id) {
                        console.log(id.namespace + ": " + (id.message ? id.message : id));
                    });
                }
            }

            adobePrivacy.retrieveIdentities(callback).then(function(results) {
                console.log("retrieveIdentities results: " + results);
            });
        }, true);
    </script>

    // **Example validIds:**
    {
        "company": "adobe",
        "namespace": "ECID",
        "namespaceId": 4,
        "type": "standard",
        "name": "Experience Cloud ID",
        "description": "This is the ID generated by Visitor and set in 1st party cookie.",
        "value": "123456789098765432123456789"
    },
    {
        "company": "adobe",
        "namespace": "gsurfer_id",
        "namespaceId": 411,
        "type": "standard",
        "name": "",
        "description": "",
        "value": "abcde12345fghij67890"
    }
    ```

3. Retrieve Identities and remove them from the browser:

    ```
    adobePrivacy.removeIdentities(function (validIds, errors) {
        // **validIds** is a JSON object containing ALL the IDs that were retrieved, and will tag the `isDeletedClientSide` field for each deleted one as `true`
    });

    // **Example validIds:**
    {
        "company": "adobe",
        "namespace": "ECID",
        "namespaceId": 4,
        "type": "standard",
        "name": "Experience Cloud ID",
        "description": "This is the ID generated by Visitor and set in 1st party cookie.",
        "value": "123456789098765432123456789",
        "isDeletedClientSide": false
    },
    {
        "company": "adobe",
        "namespace": “AMO",
        "namespaceId": 411,
        "type": "standard",
        "name": "",
        "description": "",
        "value": "abcde12345fghij67890",
        "isDeletedClientSide": true
    }
    ```
