# The Adobe Privacy JavaScript Library and GDPR

Information about how Adobe works with you to comply with the European Union's General Data Protection Regulation (GDPR).

On May 25, 2018, the European Union's GDPR goes into effect. For more information about what this means for you, see [GDPR and Your Business](https://www.adobe.com/privacy/general-data-protection-regulation.html).

When Adobe is providing software and services to an enterprise, Adobe is acting as a data processor for any personal data it processes and stores as part of providing these services. As a data processor, Adobe processes personal data in accordance with your company's permission and instructions (for example, as set out in your agreement with Adobe).

As the data controller, you determine the personal data that Adobe processes and stores on your behalf. If you use Adobe Experience Cloud solutions, Adobe might host personal data for you, depending on the solutions you use and the information you choose to send to your Adobe Experience Cloud account. For a detailed list of examples, see [Adobe Experience Cloud Privacy](https://www.adobe.com/privacy/marketing-cloud.html).

## Adobe JavaScript APIs

Adobe Experience Cloud provides GDPR-ready JavaScript APIs for data controllers. Use the Adobe Privacy JavaScript library to retrieve all the IDs generated by Adobe Experience Cloud libraries for a specific domain.

The Adobe Privacy JavaScript library follows a Plugin architecture where one core object is presented to the customer and that object's API delegates the actual work to plugins. Those plugins are implemented by the individual Adobe solution teams.

The signatures for the functions presented by the Adobe Privacy JavaScript library are as follows:

* **`retrieveIdentities`**

    Promise< Object: `{ array: validIDs, array: failedIDs }`>
    callback implementation: function: `callback(Object: { array: validIDs, array: failedIDs })`

* **`removeIdentities`**

    Promise< Object: `{ array: validIDs, array: failedIDs }`>
    callback implementation: function: `callback(Object: { array: validIDs, array: failedIDs })`

    Each entry in the validIDs will be marked with `isDeleteClientSide`: true/false, depending on whether this ID has been deleted.

* **`retrieveThenRemoveIdentities`**

        Promise< Object: `{ array: validIDs, array: failedIDs }`>
        callback implementation: function: `callback(Object: { array: validIDs, array: failedIDs })`

**Note:**

* AdobePrivacy.js does not submit information to the Experience Cloud Central Service. The customer must do that. This library only provides the IDs that are stored in the browser a that specific visitor.
* **`removeIdentities`** and **`retrieveThenRemoveIdentities`** only remove identities from the browser for specific Adobe solutions that support them. For example, AAM does not delete the demdex ID that is stored in a 3rd party cookie, but Target deletes the cookies storing their IDs.

## Installation

There are multiple options to install the AdobePrivacy library:

* To install AdobePrivacy from npm, run the following command: `npm install @adobe/adobe-privacy`
* Use the Launch Extension under the name `AdobePrivacy`
* Download from [https://github.com/Adobe-Marketing-Cloud/adobe-privacy](https://github.com/Adobe-Marketing-Cloud/adobe-privacy)




## Instantiate the AdobePrivacy.js library

```
var adobePrivacy = new AdobePrivacy({ENTER YOUR ADOBE SOLUTIONS SPECIFIC CONFIGURATION HERE});
```

## Supported configurations

* **key**: An ID that identifies your visitor / data subject. This is used for your internal tracking only, Adobe does not use this property. Ex: David Smith, 12353423...

### Adobe Analytics

*   **cookieDomainPeriods**: Specifies the number periods in a domain for cookie tracking (default 2, e.g. domain.com)
*   **dataCenter**: Adobe data collection data center. d1 = San Jose data center, d2 = Dallas data center. Do not define it here unless specified in your JavaScript Web beacon
*   **reportSuite**: Report Suite ID as specified in your JavaScript Web beacon (e.g. s_code.js, dtm, etc)
*   **trackingServer**: Data collection domain (non-ssl). Do not define it here unless specified in your JavaScript Web beacon
*   **trackingServerSecure**: Data collection domain (ssl). Do not define it here unless specified in your JavaScript Web beacon
*   **visitorNamespace**: Namespace used to group visitors. Do not define it here unless specified in your JavaScript Web beacon.

### Adobe Target

**clientCode**: Client Code that identifies a client in Target System.

### Audience Manager

**aamUUIDCookieName**: Name of first party cookie with the unique user ID returned from Audience Manager

### ID Service (ECID)

**imsOrgID**: Your Organization ID in Adobe


## Code samples

The following code samples show the code to use for common scenarios, if you're not using Launch or DTM.

1. Instantiate AdobePrivacy:

    ```javascript
    var adobePrivacy = new AdobePrivacy({
        imsOrgID: “YOUR_ORG_ID@AdobeOrg",
        key: "DATA_SUBJECT_ID",
        reportSuite: "Report-Suite-ID",
        trackingServer: "metrics.mycompany.com",
        clientCode: “TARGET_CLIENT_CODE"
    });
    ```

2. Retrieve Identities by calling this asynchronous API:

    ```javascript
    function handleRetrievedIDs(ids) {
        const validIDs = ids.validIDs;
        const failedIDs = ids.failedIDs;

        // validIds and failedIDs are JSON object containing all the IDs that   // were retrieved. This object’s schema matches the schema of the Central
        // Service.
    }

    // If using callbacks:
    adobePrivacy.retrieveIdentities(handleRetrievedIDs);

    // If using Promises:
    adobePrivacy.retrieveIdentities().then(handleRetrievedIDs)…

    // Sample validIds:
    {
        "company": "adobe",
        "namespace": "ECID",
        "namespaceId": 4,
        "type": "standard",
        "name": "Experience Cloud ID",
        "description": "This is the ID generated by the ID Service.",
        "value": "79352169365966186342525781172209986543"
    },
    {
        "company": "adobe",
        "namespace": "gsurfer_id",
        "namespaceId": 411,
        "type": "standard",
        "value": "WqmIJQAAB669Ciao"
    }
    ```

3. Retrieve Identities and remove them from the browser:

    ```javascript
    function handleRemovedIDs(ids) {
        const validIDs = ids.validIDs;
        const failedIDs = ids.failedIDs;

        // validIds and failedIDs are JSON object containing all the IDs that
        // were retrieved. This object’s schema matches the schema of the Central
        // Service.
    }

    // If using callbacks:
    adobePrivacy.removeIdentities(handleRemovedIDs);

    // If using Promises:
    adobePrivacy.removeIdentities().then(handleRemovedIDs)…

    // Sample validIds:
    {
        "company": "adobe",
        "namespace": "ECID",
        "namespaceId": 4,
        "type": "standard",
        "name": "Experience Cloud ID",
        "description": "This is the ID generated by the ID Service.",
        "value": "79352169365966186342525781172209986543",
        "isDeletedClientSide": false
    },
    {
        "company": "adobe",
        "namespace": "AMO",
        "namespaceId": 411,
        "type": "standard",
        "value": "WqmIJQAAB669Ciao",
        "isDeletedClientSide": true
    }
    ```

## Result
The result of the APIs is a JSON object that contains all the IDs.

Sample output:
```javascript
{
    "companyContexts": [{
            "namespace": "imsOrgID",
            "value": "123456789@AdobeOrg"
        }
    ],
    "users": [{
        "key": "David Smith",
        "action": ["access"], // Options: ["access", "delete"]
        "userIDs": [{
                "namespace": "email",
                "value": "dsmith@acme.com",
                "type": "standard"
            },
            {
                "namespace":"myCustomField",
                "value":"myCustomId_1234",
                "type":"unregistered"
            }
        ]
    }]
}
```

Two properties worth noting:

* **Key** An identifier for the visitor, or the data subject who initiated the GDPR request. This is for tracking purposes only, so the request is tagged. Adobe does not do anything with this property.
* **Action** One or more actions that the data subject is requesting: access, delete, or both. The type of this property is an array.
